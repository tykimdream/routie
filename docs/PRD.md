# Routie — Product Requirements Document (PRD)

## 1. 개요

### 1.1 프로젝트 배경

여행자들은 가고 싶은 장소를 구글 지도에 저장해두지만, 실제 여행 시 이 장소들을 어떤 순서로 방문할지, 시간 내에 몇 곳을 돌 수 있는지 판단하기 어렵다. 특히 같은 카테고리의 장소가 여러 개일 때(예: 음식점 3곳 중 어디를 갈지) 선택에 많은 시간을 소비한다.

### 1.2 미션

> 여행자의 "어디를, 어떤 순서로 갈까"라는 고민을 데이터 기반으로 해결하여, 여행의 질을 높인다.

### 1.3 핵심 방향: 의사결정 지원

Routie의 핵심 가치는 **여행자의 의사결정을 돕는 것**이다.

모든 장소를 방문할 수 없는 현실에서, 사용자가 **합리적인 선택**을 할 수 있도록:

- 각 장소의 **장점, 평점, 리뷰 하이라이트**를 한눈에 보여준다
- 음식점/카페라면 **시그니처 메뉴와 가격대**를 제공한다
- 같은 카테고리 장소 간 **비교 정보**를 제공한다 ("A는 평점이 높지만 B는 동선상 유리")
- 경로에서 제외된 장소에 대해 **제외 이유**와 **대안**을 제시한다
- 각 장소가 경로에 포함된 **선택 사유**를 설명한다

이를 통해 사용자는 "왜 이 경로인지", "왜 이 장소를 가는 게 나은지"를 이해하고, 자신의 취향에 맞게 최종 결정을 내릴 수 있다.

### 1.4 성공 지표 (KPI)

| 지표                | 목표 (MVP) | 설명                                    |
| ------------------- | ---------- | --------------------------------------- |
| 경로 생성 완료율    | > 80%      | 장소 입력 → 경로 확인까지 완료하는 비율 |
| 경로 채택률         | > 50%      | 추천 경로를 실제 사용하는 비율          |
| 재방문율            | > 30%      | 7일 내 재사용 비율                      |
| 평균 경로 생성 시간 | < 10초     | 장소 선택 후 경로 결과까지              |

---

## 2. 사용자 페르소나

### 페르소나 A: "계획형 여행자" — 수진 (28세)

- **배경**: 해외여행 전 구글 지도에 50개 이상 장소를 저장해둠
- **고민**: 저장한 곳이 너무 많아서 일정에 넣을 곳을 고르지 못함
- **니즈**: 날짜별로 효율적인 동선을 자동으로 짜주는 서비스
- **기대**: "3일 일정인데, 이 중에서 최적으로 돌 수 있는 곳을 알려줘"

### 페르소나 B: "즉흥형 여행자" — 민수 (32세)

- **배경**: 여행지에서 당일 일정을 정함
- **고민**: 오늘 하루 어떤 순서로 돌아야 시간 낭비 없을지 모름
- **니즈**: 현재 위치 기반, 남은 시간 내 최적 경로
- **기대**: "지금 오후 2시인데, 저녁 8시까지 이 5곳 중 어디를 돌 수 있어?"

### 페르소나 C: "취향형 여행자" — 하나 (25세)

- **배경**: 카페, 맛집에 특히 관심이 많고 SNS 기반으로 장소를 저장
- **고민**: 가고 싶은 카페가 5곳인데 다 갈 수 없음
- **니즈**: 우선순위(가중치)를 반영한 추천
- **기대**: "이 카페는 꼭 갈 거고, 나머지 중에서 동선에 맞는 곳을 추천해줘"

---

## 3. 핵심 기능 정의

### 3.1 장소 가져오기 (Place Import)

| 항목     | 설명                                                   |
| -------- | ------------------------------------------------------ |
| 기능     | 구글 지도 저장 장소를 가져오기                         |
| 입력     | Google Takeout 파일 업로드 또는 직접 검색              |
| 출력     | 장소 목록 (이름, 주소, 좌표, 카테고리, 영업시간)       |
| MVP 범위 | Google Takeout 파일 파싱 + Google Places API 기반 검색 |
| 확장     | 공유 리스트 URL 파싱 (v1.1)                            |

> Google은 Saved Places에 접근할 수 있는 공식 API를 제공하지 않는다. (Google Issue Tracker #68749469) 따라서 Takeout 파일 업로드 방식을 MVP에 포함한다.

**Import 방식별 로드맵:**

| 우선순위 | 방식                       | 시기 | UX       |
| -------- | -------------------------- | ---- | -------- |
| 1        | 직접 검색 + 수동 추가      | MVP  | 번거로움 |
| 2        | Google Takeout 파일 업로드 | MVP  | 보통     |
| 3        | 공유 리스트 URL 파싱       | v1.1 | 좋음     |

**상세 요구사항:**

**직접 검색 (MVP)**

- 장소를 직접 검색하여 추가할 수 있다 (Google Places Autocomplete)
- 가져온 장소에 카테고리 태그를 지정할 수 있다 (음식, 카페, 관광, 쇼핑, 마사지 등)
- 장소별 예상 체류 시간을 설정할 수 있다 (기본값: 카테고리별 자동 설정)

**Google Takeout 파일 업로드 (MVP)**

- 사용자가 takeout.google.com에서 "Maps (Your Places)" 데이터를 다운로드
- `Saved Places.json` (GeoJSON): 장소명, 좌표, 카테고리 포함
- 리스트별 CSV: 장소명 + Google Maps URL
- 업로드된 파일을 파싱한 후 Google Places API로 상세 정보를 보강한다
- 플로우: Takeout 다운로드 → 파일 업로드 → JSON/CSV 파싱 → Places API 보강 → 장소 목록 생성

**공유 리스트 URL 파싱 (v1.1)**

- Google Maps 앱에서 저장 리스트 공유 링크를 복사하여 붙여넣기
- 서버사이드에서 URL을 파싱하여 장소 목록을 자동 생성

### 3.2 장소 가중치 설정 (Place Priority)

| 항목 | 설명                                                       |
| ---- | ---------------------------------------------------------- |
| 기능 | 각 장소에 대한 선호도/우선순위 설정                        |
| 방식 | 필수 방문 / 가고 싶음 / 시간 되면 — 3단계                  |
| 영향 | 경로 생성 시 필수 장소는 반드시 포함, 나머지는 최적화 대상 |

**상세 요구사항:**

- 🔴 **필수 (Must)**: 반드시 경로에 포함
- 🟡 **선호 (Want)**: 가능하면 포함, 경로 최적화 시 우선 고려
- 🟢 **옵션 (Optional)**: 시간·동선이 허락할 때만 포함
- 드래그 앤 드롭으로 같은 등급 내에서도 순위 조절 가능

### 3.3 경로 최적화 (Route Optimization)

| 항목     | 설명                                              |
| -------- | ------------------------------------------------- |
| 기능     | 장소, 시간, 교통을 고려한 최적 경로 생성          |
| 입력     | 장소 목록, 날짜, 시작/종료 시간, 출발지, 교통수단 |
| 출력     | 2~3개의 추천 경로 (지도 + 타임라인 뷰)            |
| 알고리즘 | TSP 변형 + 시간 제약 + 가중치 반영                |

**상세 요구사항:**

- 경로 생성 시 고려 요소:
  - 장소 간 이동 시간 (Google Directions API / Distance Matrix API)
  - 장소 영업시간 (Google Places API)
  - 각 장소 예상 체류 시간
  - 사용자 설정 가중치 (필수/선호/옵션)
  - 교통수단 (도보, 대중교통, 택시/차량)
  - 식사 시간대 고려 (음식점은 점심/저녁 시간에 배치)
- 추천 경로 유형:
  - **효율 경로**: 이동 시간 최소화, 최다 장소 방문
  - **여유 경로**: 체류 시간 넉넉하게, 피로도 고려
  - **맞춤 경로**: 필수 장소 중심 + 가중치 최적화

### 3.4 경로 뷰 (Route View)

| 항목        | 설명                                                     |
| ----------- | -------------------------------------------------------- |
| 지도 뷰     | 경로를 지도 위에 마커 + 폴리라인으로 표시                |
| 타임라인 뷰 | 시간순 일정 카드 (장소명, 시간, 이동수단, 소요시간)      |
| 상호작용    | 장소 순서 변경 (드래그), 장소 제거/추가 시 실시간 재계산 |

### 3.5 오프라인 지원 (Offline Support)

| 항목 | 설명                                   |
| ---- | -------------------------------------- |
| 기능 | 생성된 경로를 오프라인에서 확인        |
| 구현 | PWA Service Worker + IndexedDB 캐싱    |
| 범위 | 경로 데이터, 장소 정보, 기본 지도 타일 |

### 3.6 경로 내보내기 (Route Export)

| 항목     | 설명                                                     |
| -------- | -------------------------------------------------------- |
| 기능     | 생성된 경로를 외부 서비스에서 활용할 수 있도록 내보내기  |
| MVP 범위 | Google Maps URL 내보내기                                 |
| 확장     | KML/GPX (v1.1), Calendar .ics (v1.1), 이미지 공유 (v2.0) |

**Export 방식별 로드맵:**

| 포맷            | 용도                              | 시기 |
| --------------- | --------------------------------- | ---- |
| Google Maps URL | 구글 지도에서 바로 내비게이션     | MVP  |
| KML/KMZ         | Google Earth, Maps.me에서 열기    | v1.1 |
| GPX             | 대부분의 내비게이션 앱 호환       | v1.1 |
| Calendar (.ics) | Google/Apple 캘린더에 일정 추가   | v1.1 |
| 이미지 공유     | 경로 카드를 이미지로 저장 (SNS용) | v2.0 |

**Google Maps URL Export (MVP)**

- 경로를 Google Maps URL로 변환하여 사용자가 구글 지도에서 바로 확인
- URL 형식: `https://www.google.com/maps/dir/?api=1&origin=장소1&destination=마지막장소&waypoints=장소2|장소3&travelmode=transit`
- API 키 불필요, 무료 사용
- 모든 앱/웹에서 Google Maps 바로 열림
- 제한: URL 길이 2,048자 제한

---

## 4. 사용자 플로우

### 4.1 메인 플로우

```
[앱 진입]
    ↓
[로그인 / 게스트]
    ↓
[새 여행 만들기]
    ↓
[여행 정보 입력]
  - 여행지 (도시)
  - 날짜 범위
  - 일별 활동 시간 (예: 10:00~21:00)
    ↓
[장소 가져오기]
  - 구글 지도 저장 목록에서 선택
  - 직접 검색하여 추가
    ↓
[장소 설정]
  - 카테고리 태그 지정
  - 가중치 설정 (필수/선호/옵션)
  - 예상 체류 시간 조정
    ↓
[경로 생성 요청]
  - 교통수단 선택
  - 선호 스타일 선택 (효율/여유/맞춤)
    ↓
[경로 결과 확인]
  - 2~3개 경로 카드 스와이프
  - 지도 뷰 / 타임라인 뷰 전환
    ↓
[경로 수정]
  - 장소 순서 변경
  - 장소 추가/제거
  - 실시간 재계산
    ↓
[경로 확정 & 저장]
  - 오프라인 캐싱
  - 공유 링크 생성
```

### 4.2 핵심 시나리오

**시나리오: 방콕 3일 여행**

1. 수진이 구글 지도에 저장해둔 방콕 장소 20개를 가져옴
2. 장소별로 카테고리 지정: 음식점 8, 카페 5, 마사지 3, 관광 4
3. 가중치 설정:
   - 필수: "제이옥" 레스토랑, "왓포" 사원, "렛츠릴랙스" 마사지
   - 선호: 나머지 음식점 2곳, 카페 3곳
   - 옵션: 나머지 전부
4. 3일 일정, 매일 10:00~21:00 활동
5. Routie가 3개 경로 제안:
   - **경로 A (효율)**: 3일간 15곳 방문, 이동 최소화
   - **경로 B (여유)**: 3일간 10곳, 장소당 체류 넉넉
   - **경로 C (맞춤)**: 필수 3곳 + 선호 5곳 + 옵션 2곳
6. 수진이 경로 C 선택 후 일부 장소 순서를 수정
7. 확정 후 오프라인 저장

---

## 5. 비기능 요구사항

### 5.1 성능

| 항목           | 요구사항                     |
| -------------- | ---------------------------- |
| 경로 생성 시간 | < 10초 (10개 장소 기준)      |
| 초기 로딩      | < 3초 (LCP)                  |
| 오프라인 전환  | 저장된 경로 즉시 접근 가능   |
| API 응답       | P95 < 500ms (경로 생성 제외) |

### 5.2 호환성

| 항목      | 요구사항                                      |
| --------- | --------------------------------------------- |
| 브라우저  | Chrome, Safari, Samsung Internet (최신 2버전) |
| 모바일    | iOS 15+, Android 10+                          |
| 화면 크기 | 320px ~ 1440px 반응형                         |
| PWA       | 홈 화면 추가, 오프라인, 푸시 알림             |

### 5.3 보안

| 항목   | 요구사항                            |
| ------ | ----------------------------------- |
| 인증   | Supabase Auth (Google OAuth, Email) |
| API 키 | 서버사이드에서만 Google API 키 사용 |
| 데이터 | 사용자 위치 정보 암호화 저장        |
| HTTPS  | 필수                                |

---

## 6. MVP 범위 정의

### MVP에 포함

- [x] 이메일/구글 로그인
- [x] 장소 검색 및 수동 추가 (Google Places Autocomplete)
- [x] Google Takeout 파일 업로드 파싱 (Saved Places.json, CSV)
- [x] 장소 카테고리 태깅
- [x] 3단계 가중치 설정
- [x] 단일 날짜 경로 최적화
- [x] 2~3개 경로 추천
- [x] 지도 뷰 + 타임라인 뷰
- [x] 경로 수정 (순서 변경, 장소 제거)
- [x] Google Maps URL 경로 내보내기
- [x] PWA 기본 지원 (홈 화면 추가, 오프라인 경로 확인)

### MVP 이후

**v1.1 — Import/Export 확장 + 멀티데이**

- [ ] 공유 리스트 URL 파싱 (Google Maps 공유 링크 → 장소 자동 추출)
- [ ] KML/GPX 경로 내보내기
- [ ] Calendar (.ics) 내보내기
- [ ] 경로 공유 링크 생성
- [ ] 다중 날짜 경로 (멀티데이 여행)

**v1.2 — 실시간 + 협업**

- [ ] 실시간 교통 정보 반영
- [ ] 그룹 여행 (다수 사용자 장소 통합)
- [ ] 실시간 위치 기반 다음 장소 안내

**v2.0 — AI + 네이티브**

- [ ] AI 기반 장소 추천 (비슷한 취향 기반)
- [ ] 여행 기록 아카이빙 + 사진 연동
- [ ] 이미지 공유 (경로 카드를 SNS용 이미지로 저장)
- [ ] 네이티브 앱 (React Native or Flutter)

---

## 7. 제약 사항 및 리스크

| 리스크                    | 영향                     | 대응                                                |
| ------------------------- | ------------------------ | --------------------------------------------------- |
| Google Maps API 비용      | 사용량 증가 시 비용 급증 | 캐싱 전략, 요청 최소화, 무료 티어 모니터링          |
| 구글 저장 목록 API 미제공 | 직접 연동 불가           | MVP에서 수동 추가 + 검색, 이후 Takeout 파싱         |
| 경로 최적화 정확도        | 비현실적 경로 제안 가능  | 영업시간·이동시간 실데이터 활용, 사용자 피드백 반영 |
| 오프라인 지도 타일        | 저장 용량 큼             | MVP에서 텍스트 일정만 오프라인, 지도는 온라인       |
